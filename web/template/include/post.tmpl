<article class="card">
    <div class="stack">
        <a href="/@{{.Post.User.Username}}" style="text-decoration: none;" class="stack">
            {{template "avatar.tmpl" (dict "User" .Post.User)}}
            <h2 style="margin: 0; margin-left: .5rem">{{.Post.User.Username}}</h2>
        </a>

        <a href="/p/{{.Post.ID}}" style="text-decoration: none; margin-left: auto;">
            <div class="stack no-gap">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <small>
                    <time-ago>
                        <time datetime='{{.Post.CreatedAt.Format "2006-01-02T15:04:05Z07:00"}}'>
                            {{- .Post.CreatedAt.Format "02 Jan 06 15:04 MST" -}}
                        </time>
                    </time-ago>
                </small>
            </div>
        </a>
    </div>

    {{/* linkify transforms urls into anchor tags */}}
    <p style="white-space: pre-line;">{{linkify .Post.Content}}</p>

    <div class="stack" style="gap: 1rem">
        {{$reactionAction := printf "/p/%s/reactions" .Post.ID}}
        {{if .Session.IsLoggedIn}}
        {{template "add-reaction-form.tmpl" (dict "Action" $reactionAction)}}
        {{end}}
        {{$rpip := dict "Session" .Session "Action" $reactionAction "ReactionsCount" .Post.ReactionsCount}}
        {{template "reactions.tmpl" $rpip}}
        <a href="/p/{{.Post.ID}}" class="stack" style="text-decoration: none; color: inherit;"
            title="{{.Post.CommentsCount}} comments" aria-label="{{.Post.CommentsCount}} comments">
            <span>{{.Post.CommentsCount}}</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
            </svg>
        </a>
    </div>
</article>

{{define "head"}}
<script src="/time-ago.js" defer></script>
{{end}}
